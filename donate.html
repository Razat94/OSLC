<!DOCTYPE html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
	</head>

<style>
	
	html, body {
		padding: 0;
		margin: 0;
		background-color: #fafafa;//white;
		-webkit-text-size-adjust: none; /* Prevent font scaling in landscape */
	}
	
	p {
		font-family: font-family: Palatino, "Palatino Linotype", "Palatino LT STD", "Book Antiqua", Georgia, serif;//"Verdana", sans-serif; 
		display: inline-block;
		font-size: 20px;
		margin: 0;
		padding: 0;
	}
	
	.container {
		width: 80%;
		margin-left: 10%;
		background-color: #fafafa;
	}
	
	.container:nth-of-type(1) {
		border-bottom: 1px solid #c0c0c0; 
		text-align: center; 
		padding: 1px 0px;
	}
	
	.container:nth-of-type(2) {
		margin-top: 3%;
	}
	
	.field {
		width: 40%;
		display: inline-block;
		margin-bottom: 1%;
	}
	
	.field p {
		width: 100%;
		font-size: 18px;
	}
	
	.field input {
		display: block;
		width: 100%;
		min-height: 30px;
		font-size: 20px;
	}
	
	.field p:nth-of-type(2) {
		font-family: Palatino, "Palatino Linotype", "Palatino LT STD", "Book Antiqua", Georgia, serif;
		color: red;
	}
	
	.field:nth-of-type(odd) {
		margin-right: 15%;
	}
	
	#test {
		border: 1px solid gray;
		background-color: white;
	}
	
	#test:hover {
		background-color: #f0f5fa;
	}
		
	.alert {
		padding: 20px;
		background-color: #f44336;
		color: white;
		display: none;
		position: fixed;
		bottom: 0;
		width: 100%;
	}
	
	.closebtn {
		margin-right: 30px;
		color: white;
		font-weight: bold;
		float: right;
		font-size: 50px;
		line-height: 20px;
		cursor: pointer;
	}
	
	.closebtn:hover {
		color: black;
	}
	
	@media screen and (max-width: 600px) {
		
		.field {
			width: 100%;
			margin: 0;
		}
		
	}
	
</style>

<body>

	<div class = "container">
		<div>
			<h3> Enter your information below </h3>
		</div>
	</div>

	<div class = "container">
		<div class = "field">
			<p>Full name:</p>
			<input onblur = "nameChecker()">
			<p></p>
		</div>
	
		<div class = "field">
			<p>E-mail:</p>
			<input onblur = "emailCheck()">
			<p></p>
		</div>

		<div class = "field">
			<p>Phone:</p>
			<input onblur = "phoneCheck()">
			<p></p>
		</div>
	</div>
	
	<div class = "container">
		<div class = "field">
			<p>Card Number:</p>
			<input onblur = "cardNumberCheck()">
			<p></p>
		</div>
	
		<div class = "field">
			<p>Expiration Date:</p>
			<input onblur = "dateCheck()" placeholder = "MM/YY">
			<p></p>
		</div>

		<div class = "field">
			<p>Security Code: </p>
			<input onblur = "securityCodeCheck()" placeholder = "(CVC)">
			<p></p>
		</div>
	</div>
	
	<div class = "container">
		<button id = "test" onclick="mainFunction()">Test Input</button>
	</div>
	
	<div class="alert">
		<span class = "closebtn" onclick = "this.parentElement.style.display='none';">&times;</span> 
		<strong>&#9888;</strong>Your form has encountered an error. Press any key to continue. 
	</div>

<script>

// GOOD TO KNOW

// According to a response from: https://stackoverflow.com/questions/21193437/can-i-select-multiple-tags-using-getelementsbytagname
// "you can't select multiple tags with a single call to getElementsByTagName"

// https://stackoverflow.com/questions/14735197/activate-a-javascript-function-with-a-keypress
// https://stackoverflow.com/questions/16089421/simplest-way-to-detect-keypresses-in-javascript
// https://stackoverflow.com/questions/5597060/detecting-arrow-key-presses-in-javascript
// https://stackoverflow.com/questions/6121203/how-to-do-fade-in-and-fade-out-with-javascript-and-css
// https://www.w3schools.com/jsref/event_onfocus.asp
// https://stackoverflow.com/questions/576319/reset-an-input-controls-border-color-html-javascript

// LUHN CHECK CONTRADICTIONS	
// https://www.rosettacode.org/wiki/Luhn_test_of_credit_card_numbers
// https://www.youtube.com/watch?v=wsphC8V36i0
// https://en.wikipedia.org/wiki/Luhn_algorithm
// https://stackoverflow.com/questions/6176802/how-to-validate-credit-card-number
// https://stackoverflow.com/questions/12761922/how-do-i-validate-credit-card-and-bank-account-numbers
	
// CONFLICTING 
// https://www.fivecentnickel.com/how-do-you-know-if-a-credit-card-number-is-valid/
// http://www.ee.unb.ca/cgi-bin/tervo/luhn.pl
// http://www.freeformatter.com/credit-card-number-generator-validator.html

/*
//document.getElementsByClassName("alert")[0].addEventListener("keypress", myFunction);
//document.addEventListener("keypress", myFunction);
function myFunction() {
    document.getElementsByClassName("alert")[0].style.display = 'none';
}
*/

/*
function code(e) {
    e = e || window.event;
    return(e.keyCode || e.which);
}
window.onload = function(){
    document.onkeypress = function(e){
        var key = code(e);
     //  if ( key < 10175 ) alert ("hi");
    };
};
*/

function fade(element) {
    var op = 1;  // initial opacity
    var timer = setInterval(function () {
        if (op <= 0.1){
            clearInterval(timer);
            element.style.display = 'none';
        }
        element.style.opacity = op;
        element.style.filter = 'alpha(opacity=' + op * 100 + ")";
        op -= op * 0.4;
    }, 50);
	document.getElementById("test").blur();
}

window.onkeydown = function(event) {
	event = event.keyCode || window.event;
	if (event < 10175) {
		// myFunction();
		fade ( document.getElementsByClassName("alert")[0] );
	}
}

window.onscroll = function() {
	fade ( document.getElementsByClassName("alert")[0] );
};



function mainFunction() {
	var array_of_functions = [ nameChecker , emailCheck , phoneCheck , cardNumberCheck, dateCheck, securityCodeCheck] 
	var value;
	
	// Loop thatt checks if any of the inputs are false and makes mainFunction() return false if there is one.
	for (var i = 0; i < array_of_functions.length; i++) {
		value = array_of_functions[i]();
		if ( value == 0 ) {
			document.getElementsByClassName("alert")[0].style.display = 'block';
			document.getElementsByClassName("alert")[0].style.opacity = '1';
			return false;
		}
	}
	
	document.getElementsByClassName("alert")[0].style.display = 'none';
}



function nameChecker() {
	
	var div = document.getElementsByClassName("container")[1];
	var firstDiv = div.getElementsByClassName("field")[0]; // get's 1st div element with class "field" from document.
	var input = firstDiv.getElementsByTagName("input")[0].value; // get the value from 1st input tag from firstDiv.
	var errorMessage = firstDiv.getElementsByTagName("p")[1]; // set the error message to be the 2nd <p> in the 1st div element that is of class "field".
	errorMessage.innerHTML = "";
	
	/*
	//Exception handling is similar to the code below:
	if (input.length == 0 || !isNaN(input) || input.length > 100 || ! ( /^[A-z -]+$/.test(input) ) ) {
		errorMessage.innerHTML = "Input is incorrect ";
		return 0;
	}
	else return 1;
	*/
	
	try {
		if (input == "") throw "is empty";
		if(!isNaN(input)) throw "contains numbers";
		if (input.length > 100 ) throw ("is too big");
		if ( ! ( /^[A-z -]+$/.test(input) ) ) throw ("contains invalid characters"); // Name only contains alphabetic characters from A-z and a hyphen(-).
	}
	
	catch (err) {
		errorMessage.innerHTML = "Input " + err;
		//message.insertAdjacentHTML('afterend', "Input is" + err + "<br>");
		firstDiv.getElementsByTagName("input")[0].style.border = "2px solid red";
		return 0;
	}

	firstDiv.getElementsByTagName("input")[0].style.removeProperty('border');
	return 1;
	
}

function emailCheck() {
	var div = document.getElementsByClassName("container")[1];
    var secondDiv = div.getElementsByClassName("field")[1]; 
	var input = secondDiv.getElementsByTagName("input")[0].value;
	var errorMessage = secondDiv.getElementsByTagName("p")[1]; 
    errorMessage.innerHTML = "";
	
	try {
		if (input == "") throw "is empty";
		if (input.length > 200 ) throw ("is too big");
		if (!input.includes("@")) throw ("is not a valid e-mail address");
		
	}
	
	catch (err) {
		errorMessage.innerHTML = "Input " + err;
		secondDiv.getElementsByTagName("input")[0].style.border = "2px solid red";
		return 0;
	}
	
	secondDiv.getElementsByTagName("input")[0].style.removeProperty('border');
	return 1;
}

function phoneCheck() {
	var div = document.getElementsByClassName("container")[1];
    var thirdDiv = div.getElementsByClassName("field")[2]; 
	var x = thirdDiv.getElementsByTagName("input")[0].value;
	var errorMessage = thirdDiv.getElementsByTagName("p")[1]; 
    errorMessage.innerHTML = "";
	
	try {
		if(x == "")  throw "empty";
        if(isNaN(x)) throw "not a number";
        if(Number(x) < 0 ) throw "a negative numbers";
        if(Number(x) % 1 != 0 ) throw "a decimal numbers";
	}
	
	catch (err) {
		errorMessage.innerHTML = "Input " + err;
		thirdDiv.getElementsByTagName("input")[0].style.border = "2px solid red";
		return 0;
	}
	
	thirdDiv.getElementsByTagName("input")[0].style.removeProperty('border');
	return 1;
}



function cardNumberCheck() {
	var div = document.getElementsByClassName("container")[2];
    var secondDiv = div.getElementsByClassName("field")[0]; // 2nd Div of class "field"
	var x = secondDiv.getElementsByTagName("input")[0].value;
	var errorMessage = secondDiv.getElementsByTagName("p")[1]; // 2nd p element
    errorMessage.innerHTML = "";
	
    try { 
        if(x == "")  throw "empty";
        if(isNaN(x)) throw "not a number";
		if(x.length < 10) throw "too small";
		if(x.length > 19) throw "too big";
        if(Number(x) < 0 ) throw "a negative numbers";
        if(Number(x) % 1 != 0 ) throw "a decimal numbers";
		if(!luhnCheck(x)) throw "not valid according to Luhns Algorithm";
    }
    catch(err) {
        errorMessage.innerHTML = "Input is " + err;
		secondDiv.getElementsByTagName("input")[0].style.border = "2px solid red";
		return 0;
    }
	
	secondDiv.getElementsByTagName("input")[0].style.removeProperty('border');
	return 1;
}

function luhnCheck(val) {
    var sum = 0;
	var intVal;
	
    for (var i = 0; i < val.length; i++) { 
	
		// algorithm for if a card number is even # of digits (e.g., Visa or MasterCard),
        if ( i % 2 != 0 && val.length % 2 == 0 ) {
			sum = sum + Number(val.charAt(i));
		}
		
		if (i % 2 == 0 && val.length % 2 == 0) {
			intVal = Number(val.charAt(i)); // get the first number
            intVal *= 2;
            if (intVal > 9) {
                intVal = intVal - 9;
            }
			sum += intVal;
        }
		
		// algorithm for if a card number is odd # of digits
        if ( i % 2 == 0 && val.length % 2 != 0 ) {
			sum = sum + Number(val.charAt(i));
		}
		
		if (i % 2 != 0 && val.length % 2 != 0) {
			intVal = Number(val.charAt(i)); // get the first number
            intVal *= 2;
            if (intVal > 9) {
                intVal = intVal - 9;
            }
			sum += intVal;
        }
		
    }
    
	return (sum % 10) == 0; // if the expression is true, then number passes the test.
}

function dateCheck() {
	var div = document.getElementsByClassName("container")[2];
    var secondDiv = div.getElementsByClassName("field")[1];
	var x = secondDiv.getElementsByTagName("input")[0].value;
	var errorMessage = secondDiv.getElementsByTagName("p")[1];
    errorMessage.innerHTML = "";
	
	try { 
        if(x == "")  throw "empty";
        if(isNaN(x)) throw "not a number";
		if(x.length < 4) throw "too small";
		if(x.length > 4) throw "too big";
        if(Number(x) < 0 ) throw "a negative numbers";
        if(Number(x) % 1 != 0 ) throw "a decimal numbers";
    }
    catch(err) {
        errorMessage.innerHTML = "Input is " + err;
		secondDiv.getElementsByTagName("input")[0].style.border = "2px solid red";
		return 0;
    }
	
	secondDiv.getElementsByTagName("input")[0].style.removeProperty('border');
	return 1;
}

function securityCodeCheck() {
	var div = document.getElementsByClassName("container")[2];
    var secondDiv = div.getElementsByClassName("field")[2]; 
	var x = secondDiv.getElementsByTagName("input")[0].value;
	var errorMessage = secondDiv.getElementsByTagName("p")[1];
    errorMessage.innerHTML = "";
	
	try { 
        if(x == "")  throw "empty";
        if(isNaN(x)) throw "not a number";
		if(x.length < 3) throw "too small";
		if(x.length > 4) throw "too big";
        if(Number(x) < 0 ) throw "a negative numbers";
        if(Number(x) % 1 != 0 ) throw "a decimal numbers";
    }
    catch(err) {
        errorMessage.innerHTML = "Input is " + err;
		secondDiv.getElementsByTagName("input")[0].style.border = "2px solid red";
		return 0;
    }
	
	secondDiv.getElementsByTagName("input")[0].style.removeProperty('border');
	return 1;
	
}

</script>

</body>
</html>
